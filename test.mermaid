%%{init: { 
  "theme": "base", 
  "themeVariables": { 
    "primaryColor": "#ffffff",
    "primaryTextColor": "#000000",
    "primaryBorderColor": "#000000",
    "lineColor": "#000000",
    "secondaryColor": "#ffffff",
    "tertiaryColor": "#ffffff",
    "textColor": "#000000",
    "mainBkg": "#ffffff",
    "nodeBorder": "#000000",
    "clusterBkg": "#ffffff",
    "clusterBorder": "#000000",
    "fontSize": "16px"
  } 
}%%
sequenceDiagram
    autonumber
    participant U as User
    participant M as Manager Agent
    participant DB as Vector DB (JSON Map)
    participant W as Worker Agents
    participant MCP as MCP Server

    U->>M: Query: "Explain OPE_001 logic"
    
    Note over M, DB: 1. DISCOVERY
    M->>DB: Lookup: {code: "OPE_001"}
    DB-->>M: Hits: [Doc A, Doc B, Doc C]

    Note over M, MCP: 2. PARALLEL EXTRACTION
    M->>W: Fan-out: 3 Specific Tasks
    par Simultaneous Reads
        W->>MCP: read_pdf(Doc A, Heading X)
        W->>MCP: read_pdf(Doc B, Heading Y)
        W->>MCP: read_pdf(Doc C, Heading Z)
    end
    MCP-->>W: Return Technical Text
    
    Note over M, W: 3. CONTEXTUAL SYNTHESIS
    W-->>M: Deliver Section Analyses
    M->>M: Review, Merge & Compare
    M->>U: Final Answer (Unified Report)